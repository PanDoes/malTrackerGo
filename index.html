<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>malTrackerGo</title>
    <script>
        window.$ = window.jQuery = require('jquery');
    </script>
    <script src="node_modules/jquery-tags-input/src/jquery.tagsinput.js"></script>
    <link rel="stylesheet" type="text/css" href="node_modules/jquery-tags-input/src/jquery.tagsinput.css" />
    <link rel="stylesheet" href="default.css" />
    <script src="default.js"></script>
    <script>
        function loadRSS(users) {
            users = users.split("=")[1];
            users = users.replace(/%2C/g, ",");
            console.log(users);

            let RSSCombiner = require('rss-combiner');
            feedList = [];
            url = "https://myanimelist.net/rss.php?type=rw&u="

            users = users.split(",");

            users.forEach(user => {
                feedList.push(url + user);
            });

            console.log(feedList);

            var feedConfig = {
                size: 20,
                feeds: feedList,
                pubDate: new Date()
            };

            var xml;

            RSSCombiner(feedConfig, function(err, combinedFeed) {
                if (err) {
                    console.error(err);
                } else {
                    xml = combinedFeed.xml({
                        indent: true
                    });
                    let Parser = require('rss-parser');
                    let parser = new Parser();

                    (async() => {
                        var content = document.getElementById("display");

                        let feed = await parser.parseString(xml);
                        console.log(feed.title);

                        feed.items.forEach(item => {
                            console.log(item);
                            var div = document.createElement("div");
                            div.setAttribute('class', "item");

                            var a = document.createElement("a");
                            a.textContent = item.title;
                            a.setAttribute('href', item.link);

                            var pubDate = document.createElement("div");
                            pubDate.textContent = item.pubDate.split("-")[0];
                            pubDate.setAttribute("class", "date");

                            var desc = document.createElement("p");
                            desc.textContent = item.content;

                            div.appendChild(a);
                            div.appendChild(pubDate);
                            div.appendChild(desc);
                            content.appendChild(div);
                        });

                    })();
                }
            });

        }
        $(document).ready(function() {
            $('#tagsFriends').tagsInput();
        });
    </script>
</head>

<body>
    <form>
        <input name="tags" id="tagsFriends" value="Badtz13,Pandoes,Fandango86" />
    </form>
    <button onclick="loadRSS($('form').serialize())">load</button>
    <div id="display">
    </div>
</body>

</html>